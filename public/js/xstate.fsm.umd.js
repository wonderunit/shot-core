var t,e;t=this,e=function(t){"use strict";var e;(e=t.InterpreterStatus||(t.InterpreterStatus={}))[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped";const n={type:"xstate.init"};function i(t){return void 0===t?[]:[].concat(t)}function s(t,e){return"string"==typeof(t="string"==typeof t&&e&&e[t]?e[t]:t)?{type:t}:"function"==typeof t?{type:t.name,exec:t}:t}function r(t){return e=>t===e}function o(t){return"string"==typeof t?{type:t}:t}function a(t,e){return{value:t,context:e,actions:[],changed:!1,matches:r(t)}}const c=(t,e)=>t.actions.forEach(({exec:n})=>n&&n(t.context,e));t.assign=function(t){return{type:"xstate.assign",assignment:t}},t.createMachine=function(t,e={}){const n={config:t,_options:e,initialState:{value:t.initial,actions:i(t.states[t.initial].entry).map(t=>s(t,e.actions)),context:t.context,matches:r(t.initial)},transition:(e,c)=>{const{value:u,context:f}="string"==typeof e?{value:e,context:t.context}:e,p=o(c),g=t.states[u];if(g.on){const e=i(g.on[p.type]);for(const i of e){if(void 0===i)return a(u,f);const{target:e=u,actions:o=[],cond:c=(()=>!0)}="string"==typeof i?{target:i}:i;let d=f;if(c(f,p)){const i=t.states[e];let a=!1;const c=[].concat(g.exit,o,i.entry).filter(t=>t).map(t=>s(t,n._options.actions)).filter(t=>{if("xstate.assign"===t.type){a=!0;let e=Object.assign({},d);return"function"==typeof t.assignment?e=t.assignment(d,p):Object.keys(t.assignment).forEach(n=>{e[n]="function"==typeof t.assignment[n]?t.assignment[n](d,p):t.assignment[n]}),d=e,!1}return!0});return{value:e,context:d,actions:c,changed:e!==u||c.length>0||a,matches:r(e)}}}}return a(u,f)}};return n},t.interpret=function(e){let i=e.initialState,s=t.InterpreterStatus.NotStarted;const r=new Set,a={_machine:e,send:n=>{s===t.InterpreterStatus.Running&&(i=e.transition(i,n),c(i,o(n)),r.forEach(t=>t(i)))},subscribe:t=>(r.add(t),t(i),{unsubscribe:()=>r.delete(t)}),start:()=>(s=t.InterpreterStatus.Running,c(i,n),a),stop:()=>(s=t.InterpreterStatus.Stopped,r.clear(),a),get state(){return i},get status(){return s}};return a},Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).XStateFSM={});
